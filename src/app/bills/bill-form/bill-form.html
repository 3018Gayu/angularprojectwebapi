<!-- Fullscreen container with background image -->
<div class="fullscreen-container" style="background-image: url('https://posbytz.com/wp-content/uploads/2021/12/5-Benefits-of-Using-Supermarket-Billing-Software-scaled.jpg'); background-size: cover; background-position: center; background-repeat: no-repeat; background-attachment: fixed; min-height: 100vh; position: relative;">
  <!-- Semi-transparent overlay for better readability -->
  <div class="overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(183, 189, 247, 0.3);"></div>
  
  <!-- Content on top -->
  <div class="content d-flex align-items-center justify-content-center" style="position: relative; z-index: 2; min-height: 100vh; padding: 20px;">
    <div class="card shadow-lg p-4" [formGroup]="billForm" style="background-color: rgba(255, 248, 222, 0.95); border: none; border-radius: 15px; max-width: 900px; width: 100%;">
      <!-- Header Section -->
      <div class="d-flex justify-content-between align-items-center mb-4" style="background-color: #576A8F; color: white; padding: 15px; border-radius: 10px 10px 0 0; margin: -20px -20px 20px -20px;">
        <h4 style="font-weight: 600; margin: 0;">
          <i class="fas fa-receipt"></i> Create Bill
        </h4>
        <button class="btn btn-outline-light btn-sm" (click)="goBack()">
          <i class="fas fa-arrow-left"></i> Back
        </button>
      </div>

      <!-- CUSTOMER -->
      <div class="mb-3">
        <label class="fw-bold" style="color: #576A8F;">
          <i class="fas fa-user"></i> Customer
        </label>
        <select class="form-select mb-3" formControlName="customerId" (change)="onCustomerChange()" style="border-color: #B7BDF7; border-radius: 8px; background-color: #FFF8DE;">
          <option value="0">Walk-in Customer</option>
          <option *ngFor="let c of customers" [value]="c.customerId">
            {{ c.name }} ({{ c.loyaltyPoints }} pts)
          </option>
        </select>
      </div>

      <!-- APPLY LOYALTY DISCOUNT -->
      <div class="mb-3">
        <button class="btn btn-warning btn-sm" (click)="applyLoyaltyDiscount()" style="background-color: #FF7444; border: none; color: white; border-radius: 8px; font-weight: 600;">
          <i class="fas fa-star"></i> Apply Loyalty Discount (−10 pts)
        </button>
      </div>

      <!-- ITEMS -->
      <div formArrayName="billItems" class="mb-4">
        <table class="table table-bordered align-middle" style="border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);">
          <thead class="table-dark" style="background-color: #576A8F; color: white;">
            <tr>
              <th><i class="fas fa-box"></i> Product</th>
              <th width="90"><i class="fas fa-hashtag"></i> Qty</th>
              <th width="120"><i class="fas fa-rupee-sign"></i> Rate</th>
              <th width="120"><i class="fas fa-calculator"></i> Total</th>
              <th width="40">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of billItems.controls; let i = index" [formGroupName]="i" style="background-color: #FFF8DE;">
              <td>
                <select class="form-select" formControlName="productId" (change)="onProductChange(i)" style="border-color: #B7BDF7; border-radius: 8px; background-color: #FFF8DE;">
                  <option value="">Select product</option>
                  <option *ngFor="let p of products" [value]="p.productId">
                    {{ p.name }}
                  </option>
                </select>
              </td>
              <td>
                <input type="number" class="form-control" formControlName="quantity" (input)="calculateTotals()" style="border-color: #B7BDF7; border-radius: 8px; background-color: #FFF8DE;" />
              </td>
              <td style="color: #FF7444; font-weight: bold;">₹ {{ row.value.unitPrice }}</td>
              <td style="color: #576A8F; font-weight: bold;">₹ {{ row.value.lineTotal }}</td>
              <td>
                <button class="btn btn-danger btn-sm" (click)="removeItem(i)" style="border-radius: 8px;"> Remove
                  <i class="fas fa-times"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Add Item Button -->
      <button class="btn btn-outline-primary mb-3" (click)="addItem()" style="border-color: #576A8F; color: #576A8F; border-radius: 8px; font-weight: 600;">
        <i class="fas fa-plus-circle"></i> Add Item
      </button>

      <!-- TOTALS -->
      <div class="text-end" style="background-color: rgba(183, 189, 247, 0.1); padding: 15px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);">
        <p style="margin-bottom: 10px;">Subtotal: ₹ {{ subtotal }}</p>
        <p *ngIf="loyaltyApplied" class="text-success" style="margin-bottom: 10px;">
          <i class="fas fa-check-circle"></i> Loyalty Discount Applied: −₹ {{ loyaltyDiscount }}
        </p>
        <div class="mb-3">
          <label class="form-label fw-bold" style="color: #576A8F;">Extra Discount %</label>
          <input type="number" class="form-control w-50 d-inline" placeholder="0" formControlName="discountPercent" (input)="calculateTotals()" style="border-color: #B7BDF7; border-radius: 8px; background-color: #FFF8DE;" />
        </div>
        <h4 style="color: #FF7444; font-weight: 700;">Grand Total: ₹ {{ totalAmount }}</h4>
      </div>

      <!-- Pay & Save Button -->
      <button class="btn btn-success mt-3 w-100" (click)="save()" style="background-color: #FF7444; border: none; border-radius: 8px; font-weight: 600; font-size: 1.2rem;">
        <i class="fas fa-credit-card"></i> Pay & Save Bill
      </button>
    </div>
  </div>
</div>